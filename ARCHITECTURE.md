# ๐๏ธ Arquitectura del Sistema - Jeopardy Trivia

## ๐ Diagrama de Arquitectura

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        JEOPARDY TRIVIA                          โ
โ                      Tech Edition v1.0                         โ
โ                    Arquitectura del Sistema                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        CAPA DE PRESENTACIรN                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   HOST PANEL    โ    โ  PLAYER PANEL   โ    โ   GAME BOARD    โ
โ                 โ    โ                 โ    โ                 โ
โ โข Game Control  โ    โ โข Registration  โ    โ โข Questions     โ
โ โข Player List   โ    โ โข Answer Input  โ    โ โข Options       โ
โ โข Question Mgmt โ    โ โข Results       โ    โ โข Timer           โ
โ โข Leaderboard   โ    โ โข Score Display โ    โ โข Animations    โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ                       โ
         โ                       โ                       โ
         โผ                       โผ                       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        CAPA DE APLICACIรN                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   FRONTEND      โ    โ   WEBSOCKETS    โ    โ   STATE MGMT    โ
โ                 โ    โ                 โ    โ                 โ
โ โข Next.js 14    โ    โ โข Real-time     โ    โ โข Game State    โ
โ โข React 18      โ    โ โข Broadcasting  โ    โ โข User State    โ
โ โข TypeScript    โ    โ โข Event Sync    โ    โ โข Question Stateโ
โ โข Tailwind CSS  โ    โ โข Reconnection  โ    โ โข Score State   โ
โ โข Framer Motion โ    โ                 โ    โ                 โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ                       โ
         โ                       โ                       โ
         โผ                       โผ                       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        CAPA DE SERVICIOS                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ    BACKEND      โ    โ   API LAYER     โ    โ   BUSINESS      โ
โ                 โ    โ                 โ    โ   LOGIC         โ
โ โข FastAPI       โ    โ โข REST Endpointsโ    โ โข Game Rules    โ
โ โข Python 3.11   โ    โ โข WebSocket     โ    โ โข Score Logic   โ
โ โข Uvicorn       โ    โ โข Validation    โ    โ โข Timer Logic   โ
โ โข Pydantic      โ    โ โข Error Handlingโ    โ โข State Logic   โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ                       โ
         โ                       โ                       โ
         โผ                       โผ                       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        CAPA DE DATOS                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   DATABASE      โ    โ   PERSISTENCE   โ    โ   CACHE         โ
โ                 โ    โ                 โ    โ                 โ
โ โข SQLite        โ    โ โข User Data     โ    โ โข Game State    โ
โ โข SQLAlchemy    โ    โ โข Questions     โ    โ โข Session Data  โ
โ โข ORM           โ    โ โข Answers       โ    โ โข Temp Data     โ
โ โข Migrations    โ    โ โข Scores        โ    โ                 โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
```

## ๐ Flujo de Datos

### **1. Registro de Usuario**
```
Usuario โ Frontend โ API /register โ Database โ WebSocket โ Todos los clientes
```

### **2. Inicio de Juego**
```
Host โ Frontend โ API /start-game โ Database โ WebSocket โ Countdown โ Primera pregunta
```

### **3. Pregunta Activa**
```
Sistema โ WebSocket โ Todos los clientes โ Timer (15s) โ Respuestas โ Validaciรณn โ Puntuaciรณn
```

### **4. Siguiente Pregunta**
```
Host โ Frontend โ API /next-question โ Database โ WebSocket โ Nueva pregunta โ Reset timer
```

## ๐๏ธ Componentes del Sistema

### **Frontend (Next.js)**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        FRONTEND ARCHITECTURE                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   PAGE.TSX      โ    โ   LAYOUT.TSX    โ    โ   COMPONENTS    โ
โ                 โ    โ                 โ    โ                 โ
โ โข Role Selectionโ    โ โข Global Styles โ    โ โข HostPanel     โ
โ โข URL Detection โ    โ โข Particles     โ    โ โข PlayerPanel   โ
โ โข Routing       โ    โ โข Fonts         โ    โ โข GameBoard     โ
โ                 โ    โ โข Metadata      โ    โ โข Leaderboard   โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ                       โ
         โ                       โ                       โ
         โผ                       โผ                       โผ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   STATE MGMT    โ    โ   WEBSOCKET     โ    โ   ANIMATIONS    โ
โ                 โ    โ   CONNECTION    โ    โ                 โ
โ โข Game State    โ    โ โข Auto Connect  โ    โ โข Framer Motion  โ
โ โข User State    โ    โ โข Event Handler โ    โ โข Transitions    โ
โ โข Question Stateโ    โ โข Reconnection  โ    โ โข Effects        โ
โ โข Timer State   โ    โ โข Error Handlingโ    โ โข Particles      โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
```

### **Backend (FastAPI)**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        BACKEND ARCHITECTURE                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   MAIN.PY       โ    โ   MODELS       โ    โ   ENDPOINTS     โ
โ                 โ    โ                 โ    โ                 โ
โ โข FastAPI App   โ    โ โข User Model    โ    โ โข /register     โ
โ โข WebSocket     โ    โ โข Question Modelโ    โ โข /start-game    โ
โ โข CORS          โ    โ โข Answer Model  โ    โ โข /next-questionโ
โ โข Middleware    โ    โ โข Pydantic      โ    โ โข /submit-answerโ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ                       โ
         โ                       โ                       โ
         โผ                       โผ                       โผ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   DATABASE      โ    โ   WEBSOCKET     โ    โ   GAME LOGIC    โ
โ   OPERATIONS    โ    โ   MANAGER       โ    โ                 โ
โ                 โ    โ                 โ    โ                 โ
โ โข CRUD Ops      โ    โ โข Connections   โ    โ โข Game State    โ
โ โข Transactions  โ    โ โข Broadcasting  โ    โ โข Score Logic   โ
โ โข Queries       โ    โ โข Event Handlingโ    โ โข Timer Logic   โ
โ โข Migrations    โ    โ โข Error Handlingโ    โ โข Question Logicโ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
```

## ๐๏ธ Modelo de Datos

### **Entidades Principales**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        DATABASE SCHEMA                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ      USERS      โ    โ    QUESTIONS    โ    โ  USER_ANSWERS   โ
โ                 โ    โ                 โ    โ                 โ
โ โข id (PK)       โ    โ โข id (PK)       โ    โ โข id (PK)       โ
โ โข name          โ    โ โข question_text โ    โ โข user_id (FK)  โ
โ โข score         โ    โ โข option_a      โ    โ โข question_id   โ
โ โข is_host       โ    โ โข option_b      โ    โ โข selected_ans  โ
โ โข created_at    โ    โ โข option_c      โ    โ โข is_correct    โ
โ                 โ    โ โข option_d      โ    โ โข answered_at   โ
โ                 โ    โ โข correct_answerโ    โ                 โ
โ                 โ    โ โข is_active     โ    โ                 โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ                       โ
         โ                       โ                       โ
         โโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโ
                                 โ
                                 โผ
                    โโโโโโโโโโโโโโโโโโโ
                    โ   GAME STATE    โ
                    โ                 โ
                    โ โข is_registration_open โ
                    โ โข is_game_started      โ
                    โ โข is_question_active    โ
                    โ โข current_question      โ
                    โ โข time_remaining        โ
                    โ โข question_timer         โ
                    โโโโโโโโโโโโโโโโโโโ
```

## ๐ Patrones de Comunicaciรณn

### **WebSocket Events**
```typescript
// Eventos del Sistema
interface WebSocketEvents {
  // Registro
  'registration_started': { message: string }
  'host_confirmed': { message: string }
  
  // Juego
  'game_started': { message: string, countdown: number }
  'new_question': { question: Question, timer: number }
  'game_finished': { leaderboard: User[] }
  
  // Estado
  'game_state': { state: GameState }
}
```

### **API Endpoints**
```typescript
// REST API Structure
interface APIEndpoints {
  // Usuario
  'POST /register': { name: string, is_host: boolean } โ User
  'GET /users': void โ User[]
  
  // Juego
  'POST /start-registration': void โ { message: string }
  'POST /start-game': void โ { message: string }
  'POST /start-first-question': void โ { message: string }
  'POST /next-question': void โ { message: string }
  'POST /submit-answer': { user_id: number, question_id: number, selected_answer: string } โ { correct: boolean, score: number }
}
```

## ๐ Despliegue y Escalabilidad

### **Docker Architecture**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        DOCKER DEPLOYMENT                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   FRONTEND      โ    โ    BACKEND      โ    โ   DATABASE      โ
โ   CONTAINER     โ    โ   CONTAINER     โ    โ   VOLUME        โ
โ                 โ    โ                 โ    โ                 โ
โ โข Next.js App   โ    โ โข FastAPI App   โ    โ โข SQLite File   โ
โ โข Port 3000     โ    โ โข Port 8000     โ    โ โข Persistent    โ
โ โข Static Assets โ    โ โข WebSocket     โ    โ โข Shared        โ
โ โข Build Optimizedโ    โ โข Health Checksโ    โ โข Backup Ready  โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ                       โ
         โ                       โ                       โ
         โผ                       โผ                       โผ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   NGINX         โ    โ   DOCKER        โ    โ   MONITORING    โ
โ   PROXY         โ    โ   COMPOSE       โ    โ                 โ
โ                 โ    โ                 โ    โ                 โ
โ โข Load Balance  โ    โ โข Orchestration โ    โ โข Health Checks โ
โ โข SSL/TLS       โ    โ โข Networking    โ    โ โข Logs           โ
โ โข Static Files  โ    โ โข Volumes       โ    โ โข Metrics       โ
โ โข WebSocket     โ    โ โข Environment   โ    โ โข Alerts        โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
```

### **Kubernetes Architecture**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      KUBERNETES DEPLOYMENT                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   INGRESS       โ    โ   SERVICES       โ    โ   DEPLOYMENTS   โ
โ                 โ    โ                 โ    โ                 โ
โ โข Nginx Controllerโ    โ โข Frontend SVC  โ    โ โข Frontend (2)  โ
โ โข SSL/TLS       โ    โ โข Backend SVC    โ    โ โข Backend (2)   โ
โ โข Load Balance  โ    โ โข ClusterIP      โ    โ โข Auto Scaling  โ
โ โข WebSocket     โ    โ โข Health Checks  โ    โ โข Rolling Updateโ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ                       โ
         โ                       โ                       โ
         โผ                       โผ                       โผ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   CONFIGMAPS    โ    โ   PVC           โ    โ   MONITORING    โ
โ                 โ    โ                 โ    โ                 โ
โ โข App Config    โ    โ โข Database Data   โ    โ โข Prometheus    โ
โ โข Questions     โ    โ โข Persistent    โ    โ โข Grafana       โ
โ โข Environment   โ    โ โข Backup Ready  โ    โ โข Logs          โ
โ โข Secrets       โ    โ โข Shared        โ    โ โข Alerts        โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
```

## ๐ Seguridad y Rendimiento

### **Medidas de Seguridad**
- **Validaciรณn de datos** con Pydantic
- **Sanitizaciรณn** de inputs del usuario
- **Rate limiting** en endpoints crรญticos
- **CORS** configurado correctamente
- **WebSocket** con autenticaciรณn implรญcita

### **Optimizaciones de Rendimiento**
- **Conexiones WebSocket** persistentes
- **Broadcasting** eficiente a mรบltiples clientes
- **Caching** de estado del juego
- **Compresiรณn** de assets estรกticos
- **Lazy loading** de componentes

### **Monitoreo y Observabilidad**
- **Health checks** en todos los servicios
- **Logs estructurados** para debugging
- **Mรฉtricas** de rendimiento
- **Alertas** automรกticas
- **Tracing** de requests

## ๐ Escalabilidad

### **Escalado Horizontal**
- **Mรบltiples rรฉplicas** de frontend y backend
- **Load balancing** automรกtico
- **Session affinity** para WebSockets
- **Database sharding** (futuro)

### **Escalado Vertical**
- **Resource limits** configurados
- **Auto-scaling** basado en CPU/memoria
- **Graceful shutdown** de pods
- **Rolling updates** sin downtime

---

**Esta arquitectura estรก diseรฑada para ser escalable, mantenible y robusta, proporcionando una excelente experiencia de usuario mientras mantiene la simplicidad de desarrollo y despliegue.**
